<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Redacted Chat</title>
 <style>
  body {
  font-family: system-ui, Arial;
  background: #e9e9e9;   /* grey outer frame */
  margin: 0;
  padding: 0;
}
   .page {
  background: #fff;
  max-width: 900px;
  margin: 40px auto;
  padding: 24px 20px;
  border-radius: 10px;
}
  textarea { width: 100%; height: 90px; padding: 10px; font-size: 16px; }
  button { padding: 10px 14px; font-size: 16px; cursor: pointer; }
  .card { border: 1px solid #ddd; border-radius: 10px; padding: 14px; margin-top: 16px; }
  pre { white-space: pre-wrap; }
  .muted { color: #666; font-size: 13px; }

  /* Suggested topics */
  .topics { margin-top: 14px; }
  .topics h3 { margin: 0 0 8px 0; font-size: 16px; }
  .chips { display: flex; flex-wrap: wrap; gap: 8px; }
  .chip {
    border: 1px solid #ddd;
    background: #fafafa;
    border-radius: 999px;
    padding: 8px 12px;
    font-size: 14px;
    cursor: pointer;
    user-select: none;
  }
  .chip:hover { background: #f3f3f3; }
  .chip:active { transform: translateY(1px); }

  /* Frame style */
  .frame {
    background: #f5f5f5;
    border: 1px solid #ddd;
    border-radius: 10px;
    padding: 14px;
  }

  /* Return link */
  .return {
    display: none;
    margin-top: 14px;
    font-size: 14px;
  }
  .return a { color: #0b57d0; text-decoration: none; }
  .return a:hover { text-decoration: underline; }

  /* üëá PUT THE MEDIA QUERY HERE, AT THE END */
  @media (min-width: 768px) {
    .frame {
      padding: 16px 18px;
    }
  }
</style>
</head>
<body>
  <div class="page">
    <h1>Redacted Chat</h1>
  <p class="muted">Ask a question about <em>Redacted Science</em>.</p>

<div class="frame" style="margin-bottom:16px;">
  <strong>Source material</strong>
  <p class="muted" style="margin:6px 0 0 0;">
    This chatbot answers questions using the book <em>Redacted Science</em>.
    <br/>
    If redirection fails, you can access the source here:
  </p>
  <ul style="margin:8px 0 0 18px;">
    <li>
      <a href="https://www.redactedscience.org" target="_blank" rel="noopener">
        www.redactedscience.org
      </a>
    </li>
    <li>
      <a href="https://www.jimcraddock.com" target="_blank" rel="noopener">
        www.jimcraddock.com
      </a>
      <span class="muted"> (author site / fallback)</span>
    </li>
  </ul>
</div>

  <!-- QUERY AREA (shown initially) -->
  <div id="queryArea">
    <textarea id="q" placeholder="Type your question..."></textarea><br/><br/>
    <button id="ask">Ask</button>

    <div class="topics card" id="topics">
      <h3>Suggested topics</h3>
      <div class="chips" id="chips"></div>
      <p class="muted" style="margin:10px 0 0 0;">
        Tip: click a topic to run it instantly. Or type your own question and press <b>Ctrl+Enter</b>.
      </p>
    </div>
  </div>

  <!-- RETURN LINK (shown after answer) -->
  <div class="return" id="returnWrap">
    <a href="#" id="returnLink">‚Üê Return to query page</a>
  </div>

<div id="asked" class="frame" style="display:none;"></div>
    
  <div id="status" class="muted"></div>
  <div id="out" class="card" style="display:none;"></div>
  <div id="src" class="card" style="display:none;"></div>

  <script>
    const api = "https://api.redactedchat.com/chat";

    const queryArea = document.getElementById("queryArea");
    const returnWrap = document.getElementById("returnWrap");
    const returnLink = document.getElementById("returnLink");

    const q = document.getElementById("q");
    const ask = document.getElementById("ask");
    const status = document.getElementById("status");
    const out = document.getElementById("out");
    const src = document.getElementById("src");

    const chips = document.getElementById("chips");
    const asked = document.getElementById("asked");
    
    // Ordered for new users first
    const suggestedTopics = [
      "What is Redacted Science about?",
      "What does ‚Äúredacted‚Äù mean in Redacted Science?",
      "What reasons are given for the redaction of this science?",
      "What does the centralization of medicine and science have to do with Redacted Science?",
      "How does control over what gets indexed or remembered shape medicine, science, and the FUTURE itself?",
      "Explain the co-evolution theory.",
      "Why do standard medical tests fail to detect this condition?",
      "How does Candida function as a ‚Äúbiochemical computer‚Äù?",
      "Explain the theory around how phenobarbitol was involved in this case study.",
      "What is the role of electrolytes, pressure, and fluid control in survival?",
      "What stages are involved in this condition?",
      "How do the sequenced stages in this condition justify the theory of co-evolution?",
      "How does this theory change how we think about chronic illness and adaptation?",
      "Why does this book argue that modern medicine is structurally incomplete‚Äînot malicious?",
      "Who is the Author of the Article discussed in Redacted Science and what were their motivations?",
      "Who might have been involved in the original research, and what are their backgrounds?"
    ];

    // Render suggestion chips
    function renderChips() {
      chips.innerHTML = suggestedTopics.map((t, i) =>
        `<div class="chip" data-i="${i}">${escapeHtml(t)}</div>`
      ).join("");

      chips.addEventListener("click", (e) => {
        const el = e.target.closest(".chip");
        if (!el) return;
        const idx = Number(el.dataset.i);
        q.value = suggestedTopics[idx];
        run(); // run immediately
      });
    }

    function showResultsMode() {
      // Hide query input + suggestions
      queryArea.style.display = "none";
      // Show return link
      returnWrap.style.display = "block";
    }

    function showQueryMode() {
      // Hide answer + sources
      out.style.display = "none";
      src.style.display = "none";
      status.textContent = "";

      // Show query input + suggestions
      queryArea.style.display = "block";
      returnWrap.style.display = "none";

      asked.style.display = "none";
      asked.innerHTML = "";

      // Optional: clear question or keep it; here we keep it for convenience
      q.focus();
    }

    async function run() {
      const question = q.value.trim();
      if (!question) return;

      ask.disabled = true;
      status.textContent = "Thinking‚Ä¶";
      out.style.display = "none";
      src.style.display = "none";
      asked.style.display = "block";
      asked.innerHTML = "<h3>Question</h3><pre></pre>";
      asked.querySelector("pre").textContent = question;
      try {
        const r = await fetch(api, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question, top_k: 5 })
        });

        const data = await r.json();
        if (!r.ok) throw new Error(data.detail || "Request failed");

        out.style.display = "block";
        out.innerHTML = "<h3>Answer</h3><pre></pre>";
        out.querySelector("pre").textContent = data.answer || "";

        const sources = data.sources || [];
        src.style.display = "block";
        src.innerHTML = "<h3>Sources</h3>" + sources.map(s =>
          `<div class="muted"><b>${escapeHtml(s.source)}</b><br/>${escapeHtml(s.content_preview)}</div><hr/>`
        ).join("");

        status.textContent = "";

        // Switch UI to results mode after success
        showResultsMode();
      } catch (e) {
        status.textContent = "Error: " + e.message;
      } finally {
        ask.disabled = false;
      }
    }

    function escapeHtml(str) {
      return (str || "").replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    ask.addEventListener("click", run);
    q.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && (e.ctrlKey || e.metaKey)) run();
    });

    returnLink.addEventListener("click", (e) => {
      e.preventDefault();
      showQueryMode();
    });

    renderChips();
  </script>
  </div>
</body>
</html>










